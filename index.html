<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gameloft CSR Day for the Planet: –õ—ñ—Å –ü–µ—Ä–µ–º–æ–≥–∏ üå≥</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase -->
    <script type="module">
        // –ò–º–ø–æ—Ä—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyATUgNMuYgCeTSzDVEKsCcLAdQuZQFsRYc",
            authDomain: "gameloft-csr-day.firebaseapp.com",
            databaseURL: "https://gameloft-csr-day-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "gameloft-csr-day",
            storageBucket: "gameloft-csr-day.firebasestorage.app",
            messagingSenderId: "616205616312",
            appId: "1:616205616312:web:e357348e67013dc232604d",
            measurementId: "G-GMB0MBQ41Y"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firestore
        const db = getFirestore(app);
        
        // –î–µ–ª–∞–µ–º –æ–±—ä–µ–∫—Ç db –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
    </script>

    <style>
        body { margin: 0; padding: 0; font-family: 'Open Sans', sans-serif; background-color: #184a49; height: 100vh; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .controls { position: fixed; top: 13%; left: 50%; transform: translateX(-50%); max-width: 180px; display: flex; flex-direction: column; align-items: center; z-index: 10; }
        select { padding: 10px; font-size: 16px; border-radius: 6px; border: 2px solid #4CAF50; background-color: white; cursor: pointer; margin-top: 10px; width: 100%; }
        #map-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #map { width: 100%; height: 100%; object-fit: cover; }
        .marker { position: absolute; width: 40px; height: 40px; background-size: cover; cursor: pointer; }
        .notification { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(43, 81, 80, 0.7); color: white; padding: 20px 30px; border-radius: 10px; font-size: 20px; text-align: center; display: none; z-index: 100; }
    </style>
</head>
<body>
    <div class="controls">
        <select id="treeType">
            <option value="pine">üå≤ –°–æ—Å–Ω–∞</option>
            <option value="birch">üå≥ –ú–∞–≥–Ω–æ–ª—ñ—è</option>
            <option value="oak">üåø –î—É–±</option>
        </select>
    </div>

    <div id="map-container">
        <img id="map" src="ukraine-map.png" alt="–ö–∞—Ä—Ç–∞ –£–∫—Ä–∞—ó–Ω–∏">
    </div>

    <div id="notification" class="notification">–î—è–∫—É—é, –≤–∞—à–µ –¥–µ—Ä–µ–≤–æ —É—Å–ø—ñ—à–Ω–æ –≤–∏—Å–∞–¥–∂–µ–Ω–æ ‚ù§Ô∏è</div>

    <script type="module">
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–µ—Ä–µ–≤—å–µ–≤
        const treeImages = {
            pine: "pine-tree.png",
            birch: "magnolia-tree.png",
            oak: "oak-tree.png"
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –Ω–∞ –∫–∞—Ä—Ç—É
        function addTreeToMap(x, y, type) {
            let tree = document.createElement("div");
            tree.classList.add("marker");
            tree.style.left = `${x - 20}px`;
            tree.style.top = `${y - 20}px`;
            tree.style.backgroundImage = `url('${treeImages[type]}')`;
            document.getElementById("map-container").appendChild(tree);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –≤ Firestore
        async function saveTree(x, y, type) {
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ—Ä–µ–≤–æ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ 'trees'
                await addDoc(collection(db, "trees"), { x, y, type });
                console.log("–î–µ—Ä–µ–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ Firestore");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ä–µ–≤—å–µ–≤ –∏–∑ Firestore
        async function loadTrees() {
            try {
                const snapshot = await getDocs(collection(db, "trees"));
                if (snapshot.empty) {
                    console.log("–î–µ—Ä–µ–≤—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ Firestore.");
                    return;
                }
                snapshot.forEach(doc => {
                    let tree = doc.data();
                    addTreeToMap(tree.x, tree.y, tree.type);
                });
                console.log("–ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–µ—Ä–µ–≤—å—è –∏–∑ Firestore");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification() {
            let notification = document.getElementById("notification");
            notification.style.display = "block";
            setTimeout(() => notification.style.display = "none", 3000);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–µ
        document.getElementById("map").addEventListener("click", function(event) {
            let x = event.offsetX;
            let y = event.offsetY;
            let selectedTree = document.getElementById("treeType").value;
            addTreeToMap(x, y, selectedTree);
            saveTree(x, y, selectedTree);
            showNotification();
        });

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ä–µ–≤—å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = loadTrees;
    </script>
</body>
</html>
